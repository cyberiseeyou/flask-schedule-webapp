{% extends "base.html" %}

{% block title %}Daily Schedule - {{ selected_date.strftime('%A, %B %d, %Y') }}{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/pages/daily-view.css') }}?v={{ config.get('VERSION', '1.0') }}">
<style>
  /* Modal styles for reschedule functionality */
  .modal-backdrop {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1001;
  }

  .action-modal {
    background: var(--bg-primary);
    border-radius: var(--border-radius-lg);
    padding: var(--spacing-xl);
    max-width: 500px;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: var(--shadow-lg);
    position: relative;
  }

  .action-modal h3 {
    margin-top: 0;
    color: var(--text-primary);
    border-bottom: 2px solid var(--pc-light-blue);
    padding-bottom: var(--spacing-sm);
  }

  .action-modal .form-group {
    margin-bottom: var(--spacing-md);
  }

  .action-modal .form-group label {
    display: block;
    margin-bottom: var(--spacing-xs);
    font-weight: var(--font-weight-bold);
    color: var(--text-primary);
  }

  .action-modal .form-group input,
  .action-modal .form-group select {
    width: 100%;
    padding: var(--spacing-sm);
    border: 1px solid #ddd;
    border-radius: var(--border-radius-sm);
    box-sizing: border-box;
  }

  .modal-actions {
    display: flex;
    gap: var(--spacing-sm);
    justify-content: flex-end;
    margin-top: var(--spacing-lg);
    padding-top: var(--spacing-md);
    border-top: 1px solid #ddd;
  }

  .hidden {
    display: none !important;
  }
</style>
{% endblock %}

{% block content %}
<div class="daily-view-container" data-selected-date="{{ selected_date.strftime('%Y-%m-%d') }}">
  <!-- Header Section -->
  <div class="daily-view-header">
    <!-- Back to Calendar Button -->
    <a href="{{ url_for('main.calendar_view') }}" class="btn-back" aria-label="Back to calendar">
      <span class="icon">‚Üê</span>
      <span class="btn-text">Back to Calendar</span>
    </a>

    <!-- Date Navigation -->
    <div class="date-navigation">
      <a href="{{ url_for('main.daily_schedule_view', date=prev_date.strftime('%Y-%m-%d')) }}"
         class="btn-nav btn-nav-prev"
         aria-label="Previous day">
        ‚Üê
      </a>

      <h1 class="daily-date">
        {{ selected_date.strftime('%A, %B %d, %Y').upper() }}
      </h1>

      <a href="{{ url_for('main.daily_schedule_view', date=next_date.strftime('%Y-%m-%d')) }}"
         class="btn-nav btn-nav-next"
         aria-label="Next day">
        ‚Üí
      </a>
    </div>

    <!-- Role Assignments -->
    <div class="role-assignments">
      <div class="role-item">
        <span class="role-icon" aria-hidden="true">üë§</span>
        <span class="role-label">Juicer:</span>
        {% if juicer and juicer.employee %}
          <strong class="role-value">{{ juicer.employee.name }}</strong>
        {% else %}
          <span class="no-assignment">No Juicer assigned</span>
          <a href="{{ url_for('rotations.index') }}" class="link-subtle" aria-label="Assign Juicer for this day">Assign</a>
        {% endif %}
      </div>

      <div class="role-item">
        <span class="role-icon" aria-hidden="true">‚≠ê</span>
        <span class="role-label">Primary Lead Event Specialist:</span>
        {% if primary_lead and primary_lead.employee %}
          <strong class="role-value">{{ primary_lead.employee.name }}</strong>
        {% else %}
          <span class="no-assignment">No Primary Lead assigned</span>
          <a href="{{ url_for('rotations.index') }}" class="link-subtle" aria-label="Assign Primary Lead for this day">Assign</a>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="daily-view-content">
    <!-- Event Type Summary -->
    <div id="daily-summary" class="dashboard-section">
      <!-- JavaScript will populate this -->
      <div class="loading-spinner" role="status" aria-live="polite">
        <span class="sr-only">Loading summary...</span>
        Loading...
      </div>
    </div>

    <!-- Core Timeslot Coverage -->
    <div class="dashboard-section">
      <h3 class="section-title">Core Timeslot Coverage</h3>
      <div id="timeslot-blocks" class="timeslot-grid">
        <!-- JavaScript will populate this -->
        <div class="loading-spinner" role="status" aria-live="polite">
          <span class="sr-only">Loading timeslots...</span>
          Loading...
        </div>
      </div>
    </div>

    <!-- Employee Attendance Section (Separate from Events) -->
    <div class="dashboard-section">
      <h3 class="section-title">Employee Attendance</h3>
      <div id="attendance-list-container" class="attendance-list">
        <!-- JavaScript will populate this -->
        <div class="loading-spinner" role="status" aria-live="polite">
          <span class="sr-only">Loading attendance...</span>
          Loading...
        </div>
      </div>
    </div>

    <!-- Event Cards Section (Story 3.3) -->
    <div class="dashboard-section">
      <h3 class="section-title">Scheduled Events</h3>
      <div id="event-cards-container" class="event-cards">
        <!-- JavaScript will populate this -->
        <div class="loading-spinner" role="status" aria-live="polite">
          <span class="sr-only">Loading events...</span>
          Loading events...
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Reschedule Event Modal -->
<div class="modal-backdrop" id="reschedule-modal" style="display: none;">
    <div class="action-modal">
        <button class="modal-close" onclick="window.dailyView.closeRescheduleModal()">&times;</button>
        <h3>Reschedule Event</h3>
        <form id="reschedule-form">
            <input type="hidden" id="reschedule-schedule-id">
            <div class="form-group">
                <label>Event:</label>
                <div id="reschedule-event-info"></div>
            </div>
            <div class="form-group">
                <label for="reschedule-date">New Date:</label>
                <input type="date" id="reschedule-date" required>
            </div>
            <div class="form-group">
                <label for="reschedule-time">New Time:</label>
                <input type="time" id="reschedule-time" required>
                <select id="reschedule-time-dropdown" class="hidden">
                    <option value="">Select a time</option>
                </select>
            </div>
            <div class="form-group">
                <label for="reschedule-employee">Employee:</label>
                <select id="reschedule-employee" required>
                    <option value="">Loading...</option>
                </select>
            </div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" onclick="window.dailyView.closeRescheduleModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Reschedule</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Load daily view JavaScript -->
<script src="{{ url_for('static', filename='js/pages/daily-view.js') }}?v={{ config.get('VERSION', '1.0') }}" defer></script>
{% endblock %}
