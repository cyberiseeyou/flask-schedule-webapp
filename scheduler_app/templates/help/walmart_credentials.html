{% extends "base.html" %}

{% block title %}Walmart Credentials - Help{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/help.css') }}">
{% endblock %}

{% block content %}
<div class="help-container">
    <aside class="help-sidebar">
        <h2>Help Topics</h2>
        <nav class="help-nav">
            <a href="{{ url_for('help.getting_started') }}" class="help-nav-item">
                <span class="help-icon">üöÄ</span>
                Getting Started
            </a>
            <a href="{{ url_for('help.walmart_credentials') }}" class="help-nav-item active">
                <span class="help-icon">üîë</span>
                Walmart Credentials
            </a>
            <a href="{{ url_for('help.employee_management') }}" class="help-nav-item">
                <span class="help-icon">üë•</span>
                Employee Management
            </a>
            <a href="{{ url_for('help.auto_scheduler_guide') }}" class="help-nav-item">
                <span class="help-icon">ü§ñ</span>
                Auto Scheduler
            </a>
            <a href="{{ url_for('help.review_approve') }}" class="help-nav-item">
                <span class="help-icon">‚úÖ</span>
                Review & Approve
            </a>
        </nav>
    </aside>

    <main class="help-content">
        <h1>üîë Walmart Retail Link Credentials</h1>

        <p class="help-intro">
            To integrate with Walmart's Retail Link system, you need to configure your API credentials.
            This guide will walk you through the setup process.
        </p>

        <div class="help-section">
            <h2>What are Walmart Retail Link Credentials?</h2>
            <p>
                Walmart Retail Link credentials are your username and password for accessing Walmart's
                Crossmark API system. These credentials allow the scheduler to:
            </p>
            <ul>
                <li>Fetch unscheduled events (mPlans) from Walmart</li>
                <li>Retrieve employee information from Crossmark</li>
                <li>Submit approved schedules back to Walmart's system</li>
                <li>Sync event status and updates</li>
            </ul>
        </div>

        <div class="help-section">
            <h2>How to Set Up Your Credentials</h2>

            <div class="steps-list">
                <div class="step-item">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h3>Navigate to Settings</h3>
                        <p>
                            Click on your name in the top-right corner to open the user dropdown menu,
                            then select <strong>Settings</strong>.
                        </p>
                    </div>
                </div>

                <div class="step-item">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h3>Locate the API Configuration Section</h3>
                        <p>
                            On the Settings page, scroll to the <strong>Walmart Retail Link API Configuration</strong> section.
                        </p>
                    </div>
                </div>

                <div class="step-item">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h3>Enter Your Credentials</h3>
                        <p>
                            Fill in the following fields:
                        </p>
                        <ul>
                            <li><strong>API Username:</strong> Your Crossmark/Walmart Retail Link username</li>
                            <li><strong>API Password:</strong> Your Crossmark/Walmart Retail Link password</li>
                            <li><strong>API Base URL:</strong> Usually <code>https://crossmark.mvretail.com</code> (pre-filled)</li>
                        </ul>
                    </div>
                </div>

                <div class="step-item">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h3>Test the Connection</h3>
                        <p>
                            Click the <strong>Test Connection</strong> button to verify that your credentials
                            are correct and the system can connect to Walmart's API.
                        </p>
                        <div class="info-box">
                            <strong>‚úì Success:</strong> You'll see a green message indicating successful authentication.
                            <br>
                            <strong>‚úó Failed:</strong> A red error message will appear. Double-check your credentials and try again.
                        </div>
                    </div>
                </div>

                <div class="step-item">
                    <div class="step-number">5</div>
                    <div class="step-content">
                        <h3>Save Your Settings</h3>
                        <p>
                            Once the connection test is successful, click <strong>Save Settings</strong>
                            to store your credentials securely.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <div class="help-section">
            <h2>Where to Find Your Credentials</h2>
            <p>
                Your Walmart Retail Link credentials are the same login credentials you use to access
                the Crossmark portal at <a href="https://crossmark.mvretail.com" target="_blank">crossmark.mvretail.com</a>.
            </p>
            <p>
                If you don't have credentials or have forgotten them:
            </p>
            <ul>
                <li>Contact your Walmart account manager</li>
                <li>Contact Crossmark support</li>
                <li>Check with your company's system administrator</li>
            </ul>
        </div>

        <div class="help-section">
            <h2>Security Best Practices</h2>
            <div class="warning-box">
                <strong>‚ö†Ô∏è Important Security Information</strong>
            </div>
            <ul>
                <li>Never share your credentials with unauthorized users</li>
                <li>Credentials are stored securely using environment variables</li>
                <li>The system uses secure HTTPS connections for all API calls</li>
                <li>Session tokens expire after 24 hours for security</li>
                <li>Change your password regularly (every 90 days recommended)</li>
            </ul>
        </div>

        <div class="help-section">
            <h2>Troubleshooting</h2>

            <h3>Connection Test Fails</h3>
            <p><strong>Possible causes and solutions:</strong></p>
            <ul>
                <li>
                    <strong>Invalid credentials:</strong> Double-check your username and password.
                    Passwords are case-sensitive.
                </li>
                <li>
                    <strong>Account locked:</strong> Too many failed login attempts may lock your account.
                    Contact Crossmark support.
                </li>
                <li>
                    <strong>Network issues:</strong> Ensure your server has internet access and can reach
                    <code>https://crossmark.mvretail.com</code>
                </li>
                <li>
                    <strong>Firewall blocking:</strong> Your network firewall may be blocking outbound
                    connections. Contact your IT department.
                </li>
            </ul>

            <h3>Events Not Syncing</h3>
            <p>
                If events aren't syncing after setting up credentials:
            </p>
            <ul>
                <li>Verify credentials are saved correctly by testing the connection again</li>
                <li>Check the Dashboard for sync errors or warnings</li>
                <li>Try using the manual "Sync Events" button in Settings</li>
                <li>Review the application logs for detailed error messages</li>
            </ul>

            <h3>Authentication Expired</h3>
            <p>
                If you see "Session expired" or "Authentication failed" errors:
            </p>
            <ul>
                <li>Sessions expire after 24 hours of inactivity</li>
                <li>Simply log out and log back in to create a new session</li>
                <li>The system will automatically re-authenticate for background tasks</li>
            </ul>
        </div>

        <div class="help-section">
            <h2>Multi-Factor Authentication (MFA)</h2>
            <p>
                If your Walmart Retail Link account has Multi-Factor Authentication (MFA) enabled:
            </p>
            <ul>
                <li>You may need to provide your MFA code during the first login</li>
                <li>The system will maintain the authenticated session after successful MFA</li>
                <li>Contact your system administrator if MFA is causing issues with automated syncing</li>
            </ul>
        </div>

        <div class="help-section">
            <h2>Next Steps</h2>
            <p>
                Once your credentials are configured and tested successfully:
            </p>

            <div class="next-steps-grid">
                <a href="{{ url_for('help.employee_management') }}" class="next-step-card">
                    <span class="next-step-icon">üë•</span>
                    <span class="next-step-text">Add employees to your roster</span>
                </a>
                <a href="{{ url_for('help.auto_scheduler_guide') }}" class="next-step-card">
                    <span class="next-step-icon">ü§ñ</span>
                    <span class="next-step-text">Learn about the auto scheduler</span>
                </a>
                <a href="{{ url_for('main.dashboard') }}" class="next-step-card">
                    <span class="next-step-icon">üè†</span>
                    <span class="next-step-text">Return to Dashboard</span>
                </a>
            </div>
        </div>
    </main>
</div>
{% endblock %}
